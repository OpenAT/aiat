var LightboxOptions={resizeSpeed:7,overlayOpacity:.8,borderSize:10,startSize:250},Lightbox=Class.create({initialize:function(){this.options={fileLoadingImage:systemVars.htmlRoot+systemVars.templatesFolder+"images/loading.gif",resizeSpeed:LightboxOptions.resizeSpeed,overlayOpacity:LightboxOptions.overlayOpacity,borderSize:LightboxOptions.borderSize,startSize:LightboxOptions.startSize},this.imageArray=[],this.domElements={},this.activeImage=null,this.isIframe=!1,this.isAnimating=!1,this.newPosAnimation=!1,this.slideshowPlaying=!0,this.slideshowPE=null,this.slideshowDuration=5,this.updateImageList(),this.keyboardAction=this.keyboardAction.bind(this),this.resizeDuration=.15*(11-this.options.resizeSpeed),this.overlayDuration=.2},updateImageList:function(){document.on("click","*[data-lightbox]",function(a){a.stop(),this.start(a.findElement("*[data-lightbox]"))}.bind(this))},start:function(a){if(this.isAnimating=!0,this.domElements.objBody=$$("body")[0],!this.domElements.lxOverlay){this.domElements.objBody.appendChild(Builder.node("div",{id:"lxOverlay"})),this.domElements.objBody.appendChild(Builder.node("div",{id:"lightbox"},[Builder.node("div",{id:"lxOuterImageContainer"},Builder.node("div",{id:"lxImageContainer"},[Builder.node("div",{id:"lxMedia"}),Builder.node("div",{id:"lxHoverNav"},[Builder.node("a",{id:"lxImageNext",href:"#"}),Builder.node("a",{id:"lxImagePrev",href:"#"}),Builder.node("a",{id:"lxImagePlay",href:"#"}),Builder.node("a",{id:"lxImagePause",href:"#"}),Builder.node("a",{id:"lxNavClose",href:"#"})]),Builder.node("div",{id:"lxLoading"},Builder.node("img",{src:this.options.fileLoadingImage}))])),Builder.node("div",{id:"lxDataContainer"},[Builder.node("div",{id:"lxData"}),Builder.node("div",{id:"lxBottomNav"},[Builder.node("a",{id:"lxPrevLink",href:"#"},"<<"),Builder.node("span",{id:"lxNumberDisplay"}," "),Builder.node("a",{id:"lxNextLink",href:"#"},">>")])])]));var b=this,c="lxOverlay lightbox lxOuterImageContainer lxImageContainer lxMedia lxHoverNav lxImageNext lxImagePrev lxImagePlay lxImagePause lxNavClose lxLoading lxDataContainer lxData lxBottomNav lxPrevLink lxNumberDisplay lxNextLink";$w(c).each(function(a){b.domElements[a]=$(a)}),this.domElements.lxOverlay.setStyle({position:"absolute",top:"0px",left:"0px",width:"100%",height:"500px",lineHeight:"0px"}).hide().observe("click",function(){this.end()}.bind(this)),this.domElements.lightbox.setStyle({position:"absolute",top:"0px",left:"0px"}).hide().observe("click",function(a){"lightbox"==a.element().id&&this.end()}.bind(this)),this.domElements.lxOuterImageContainer.setStyle({position:"relative",width:this.options.startSize+"px",height:this.options.startSize+"px"}),this.domElements.lxDataContainer.setStyle({width:this.options.startSize+"px",overflow:"hidden"}),this.domElements.lxImageContainer.setStyle({padding:this.options.borderSize+"px"}),this.domElements.lxData.setStyle({padding:"0px 0px "+this.options.borderSize+"px "+this.options.borderSize+"px",float:"left",width:"88%"}),this.domElements.lxBottomNav.setStyle({padding:"0px "+this.options.borderSize+"px "+this.options.borderSize+"px 0px",float:"right"}),this.domElements.lxNumberDisplay.setStyle({padding:"0px "+this.options.borderSize+"px"}),this.domElements.lxLoading.setStyle({position:"absolute",top:"40%",left:"0%",width:"100%",height:"25%",lineHeight:"0px",textAlign:"center"}),this.domElements.lxHoverNav.setStyle({position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",textAlign:"right"}),this.domElements.lxImageNext.setStyle({display:"block",position:"absolute",right:"0px",top:"0px",width:"33%",height:"100%",overflow:"hidden"}),this.domElements.lxImagePrev.setStyle({display:"block",position:"absolute",left:"0px",top:"0px",width:"33%",height:"100%",overflow:"hidden"}),this.domElements.lxImagePlay.setStyle({display:"block",position:"absolute",left:"33%",top:"0px",width:"33%",height:"100%",overflow:"hidden"}),this.domElements.lxImagePause.setStyle({display:"block",position:"absolute",left:"33%",top:"0px",width:"33%",height:"100%",overflow:"hidden"}),this.domElements.lxNavClose.setStyle({display:"block",position:"absolute",top:"0px",right:"0px"}).observe("click",function(a){a.stop(),this.end()}.bind(this)),this.domElements.lxImagePrev.observe("click",function(a){a.stop(),this.slideshowPause(),this.changeImage(this.activeImage-1)}.bind(this)),this.domElements.lxPrevLink.observe("click",function(a){a.stop(),this.slideshowPause(),this.changeImage(this.activeImage-1)}.bind(this)),this.domElements.lxImageNext.observe("click",function(a){a.stop(),this.slideshowPause(),this.changeImage(this.activeImage+1)}.bind(this)),this.domElements.lxNextLink.observe("click",function(a){a.stop(),this.slideshowPause(),this.changeImage(this.activeImage+1)}.bind(this)),this.domElements.lxImagePlay.observe("click",this.slideshowPlay.bind(this)).hide(),this.domElements.lxImagePause.observe("click",this.slideshowPause.bind(this)),Event.observe(window,"scroll",this.positionLightbox.bind(this))}this.domElements.lxImagePrev.show(),this.domElements.lxImageNext.show(),this.domElements.lxImagePlay.hide(),this.domElements.lxImagePause.show(),this.domElements.lxOverlay.setStyle({height:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)+"px"}),new Effect.Appear(this.domElements.lxOverlay,{duration:this.overlayDuration,from:0,to:this.options.overlayOpacity,queue:{scope:"lightbox"}}),this.imageArray=[];for(var d=null,e={href:a.getAttribute("href"),collection:"",tool:"",spalte:"",sprach_connect:"",source:"",url:"",w:"",h:""},f=a.getAttribute("data-lightbox").split(" "),g=0,h=f.length;h>g;++g){var i=f[g].split(":");e[i[0]]=i[1]}var j=$$("*[data-lightbox~='collection:"+e.collection+"']");this.imageHash={},this.imageArray=[],j.collect(function(a){var b=a.getAttribute("data-lightbox");this.imageHash[b]||(this.imageHash[b]=!0,this.imageArray.push(a))},this),this.imageArray=this.imageArray.collect(function(a){for(var b={href:a.getAttribute("href"),collection:"",tool:"",spalte:"",sprach_connect:"",source:"",url:"",w:"",h:""},c=a.getAttribute("data-lightbox").split(" "),d=0,e=c.length;e>d;++d){var f=c[d].split(":");b[f[0]]=f[1]}return b});for(var g=0,h=this.imageArray.length;h>g;++g)if(this.imageArray[g].collection==e.collection&&this.imageArray[g].tool==e.tool&&this.imageArray[g].spalte==e.spalte&&this.imageArray[g].sprach_connect==e.sprach_connect&&this.imageArray[g].source==e.source&&this.imageArray[g].url==e.url){d=g;break}null===d&&(d=this.imageArray.length,this.imageArray.push(e)),e.tool.blank()&&e.url.blank()&&!e.href.blank()&&"#"!=e.href&&(e.url=e.href),e.slideshow>0&&this.imageArray.length>1?(this.domElements.lxImagePlay.hide(),this.domElements.lxImagePause.show(),this.slideshowPlaying=!0):(this.domElements.lxImagePlay.hide(),this.domElements.lxImagePause.hide(),this.slideshowPlaying=!1),this.slideshowPE=null;var k=document.viewport.getScrollOffsets(),l=k[1]+document.viewport.getHeight()/2-this.options.startSize/2;l<k[1]+this.options.borderSize&&(l=k[1]+this.options.borderSize);var m=k[0]+document.viewport.getWidth()/2-this.options.startSize/2;m<k[0]+this.options.borderSize&&(m=k[0]+this.options.borderSize),this.domElements.lightbox.setStyle({top:l+"px",left:m+"px"}).show(),this.changeImage(d)},positionLightbox:function(){this.isAnimating||this.doPositionLightbox(this.domElements.lightbox.getWidth(),this.domElements.lightbox.getHeight())},doPositionLightbox:function(a,b){var c=this.domElements.lightbox.positionedOffset(),d=document.viewport.getScrollOffsets(),e=document.viewport.getWidth(),f=document.viewport.getHeight(),g=c[0];a+2*this.options.borderSize<e?g=d[0]+e/2-a/2:c[0]>d[0]+this.options.borderSize?g=d[0]+this.options.borderSize:c[0]+a+this.options.borderSize<d[0]+e&&(g=d[0]+e-this.options.borderSize-a);var h=c[1];b+2*this.options.borderSize<f?h=d[1]+f/2-b/2:c[1]>d[1]+this.options.borderSize?h=d[1]+this.options.borderSize:c[1]+b+this.options.borderSize<d[1]+f&&(h=d[1]+f-this.options.borderSize-b),this.newPosAnimation&&this.newPosAnimation.cancel(),this.newPosAnimation=new Effect.Move(this.domElements.lightbox,{x:g,y:h,mode:"absolute",duration:this.resizeDuration,queue:{scope:"lightbox"}})},changeImage:function(a){if(this.activeImage=a,this.domElements.lxLoading.show(),this.domElements.lxMedia.hide(),this.domElements.lxHoverNav.hide(),this.domElements.lxDataContainer.setOpacity(0),this.domElements.lxData.update(" "),this.domElements.lxPrevLink.hide(),this.domElements.lxImagePrev.hide(),this.domElements.lxNumberDisplay.hide(),this.domElements.lxNextLink.hide(),this.domElements.lxImageNext.hide(),!this.imageArray[this.activeImage].source.blank()&&!isNaN(parseInt(this.imageArray[this.activeImage].source,10))&&parseInt(this.imageArray[this.activeImage].source,10)>0)var b={source:this.imageArray[this.activeImage].source};else if(this.imageArray[this.activeImage].url.blank())var b={tool:this.imageArray[this.activeImage].tool,spalte:this.imageArray[this.activeImage].spalte,sprach_connect:this.imageArray[this.activeImage].sprach_connect};else var b={url:this.imageArray[this.activeImage].url,width:this.imageArray[this.activeImage].w,height:this.imageArray[this.activeImage].h};new Ajax.Request(systemVars.htmlRoot+systemVars.lang+"/view/ajax/lightbox/getLightboxData/",{parameters:Object.toQueryString(b),onSuccess:this.changeImageDone.bind(this)})},changeImageDone:function(a){if(a.responseText.isJSON()){var b=a.responseText.evalJSON(!0);if("object"==typeof b)if(b.fehler)this.end();else{b.width=parseInt(b.width,10),b.height=parseInt(b.height,10),b.image?(this.isIframe=!1,this.domElements.lxHoverNav.setStyle({height:"100%"}),this.domElements.lxMedia.update("<img src='"+b.image+"' alt=''>")):(this.isIframe=!0,this.domElements.lxHoverNav.setStyle({height:"auto"}),this.domElements.lxImagePlay.hide(),this.domElements.lxImagePause.hide(),this.slideshowPlaying=!1,this.domElements.lxMedia.update("<iframe src='"+b.iframe+"' width='"+b.width+"' height='"+b.height+"' frameBorder='0' seamless>")),this.domElements.lxData.update(b.desc);var c=this.domElements.lxDataContainer.getHeight();this.resizeImageContainer(b.width,b.height,c)}else this.end()}else this.end()},resizeImageContainer:function(a,b,c){var d=this.domElements.lxOuterImageContainer.getWidth(),e=this.domElements.lxOuterImageContainer.getHeight(),f=a+2*this.options.borderSize,g=b+2*this.options.borderSize,h=d-f,i=e-g;0!=h&&(new Effect.Morph(this.domElements.lxOuterImageContainer,{style:"width:"+f+"px;",duration:this.resizeDuration,queue:{scope:"lightbox"}}),new Effect.Morph(this.domElements.lxDataContainer,{style:"width:"+f+"px;",duration:this.resizeDuration,queue:{scope:"lightbox"}})),0!=i&&new Effect.Morph(this.domElements.lxOuterImageContainer,{style:"height:"+g+"px;",duration:this.resizeDuration,queue:{scope:"lightbox"}}),(0!=h||0!=i)&&this.doPositionLightbox(f,g+c);var j=100;0==i&&0==h&&Prototype.Browser.IE&&(j=250),this.domElements.lxNumberDisplay.update(this.activeImage+1+"/"+this.imageArray.length),function(){var a=f;f-this.domElements.lxNumberDisplay.getWidth()-70&&(a=f-this.domElements.lxNumberDisplay.getWidth()-70),this.domElements.lxData.setStyle({width:a+"px"}),this.showImage()}.bind(this).delay(j/1e3)},showImage:function(){this.domElements.lxLoading.hide(),this.slideshowPlaying&&this.imageArray[this.activeImage].slideshow&&this.imageArray[this.activeImage].slideshow>0&&(this.imageArray[this.activeImage].slideshow<2&&(this.imageArray[this.activeImage].slideshow=2),this.slideshowPE=window.setTimeout(function(){this.imageArray[this.activeImage+1]?this.changeImage(this.activeImage+1):this.changeImage(0)}.bind(this),1e3*this.imageArray[this.activeImage].slideshow)),new Effect.Parallel([new Effect.Appear(this.domElements.lxMedia,{sync:!0,duration:this.resizeDuration}),new Effect.SlideDown(this.domElements.lxDataContainer,{sync:!0,duration:this.resizeDuration,from:0,to:1}),new Effect.Appear(this.domElements.lxDataContainer,{sync:!0,duration:this.resizeDuration})],{duration:this.resizeDuration,queue:{position:"end",scope:"lightbox"},afterFinish:function(){this.domElements.lxOverlay.setStyle({height:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)+"px"}),this.updateNav(),this.isAnimating=!1,this.positionLightbox()}.bind(this)})},updateNav:function(){this.domElements.lxHoverNav.show(),this.activeImage>0&&(this.domElements.lxPrevLink.show(),this.isIframe||this.domElements.lxImagePrev.show()),this.activeImage<this.imageArray.length-1&&(this.domElements.lxNextLink.show(),this.isIframe||this.domElements.lxImageNext.show()),this.imageArray.length>1&&this.domElements.lxNumberDisplay.show(),this.enableKeyboardNav()},enableKeyboardNav:function(){document.observe("keydown",this.keyboardAction)},disableKeyboardNav:function(){document.stopObserving("keydown",this.keyboardAction)},keyboardAction:function(a){var b,c=a.keyCode;b=a.DOM_VK_ESCAPE?a.DOM_VK_ESCAPE:27;var d=String.fromCharCode(c).toLowerCase();"p"==d||37==c?0!=this.activeImage&&(this.disableKeyboardNav(),this.slideshowPause(),this.changeImage(this.activeImage-1)):"n"==d||39==c?this.activeImage!=this.imageArray.length-1&&(this.disableKeyboardNav(),this.slideshowPause(),this.changeImage(this.activeImage+1)):(d.match(/q|x|o|c/)||c==b)&&this.end()},slideshowPause:function(a){a&&a.stop(),this.slideshowPlaying&&(this.domElements.lxImagePlay.show(),this.domElements.lxImagePause.hide(),this.slideshowPlaying=!1),null!==this.slideshowPE&&(window.clearTimeout(this.slideshowPE),this.slideshowPE=null)},slideshowPlay:function(a){a.stop(),this.slideshowPlaying||(this.domElements.lxImagePlay.hide(),this.domElements.lxImagePause.show(),this.slideshowPlaying=!0),this.imageArray[this.activeImage+1]?this.changeImage(this.activeImage+1):this.changeImage(0)},end:function(){this.isAnimating=!0,this.slideshowPause(),this.disableKeyboardNav(),this.domElements.lightbox.hide(),new Effect.Fade(this.domElements.lxOverlay,{duration:this.overlayDuration,queue:{scope:"lightbox"},afterFinish:function(){this.domElements.lxMedia.update(" "),this.domElements.lxOuterImageContainer.setStyle({width:this.options.startSize+"px",height:this.options.startSize+"px"}),this.domElements.lxDataContainer.setStyle({width:this.options.startSize+"px"})}.bind(this)})}}),usedLightbox;Prototype.Browser.IE?Event.observe(window,"load",function(){usedLightbox=new Lightbox}):document.observe("dom:loaded",function(){usedLightbox=new Lightbox});