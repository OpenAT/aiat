var petitionApp=Class.create({initialize:function(){for(var a,b=$$("div.chart"),c=0;a=b[c];++c){for(var d=a.readAttribute("data-sections").split(","),e=[],f=0,g=d.length;g>f;++f){var h=d[f].split(":");e.push([h[0],parseInt(h[1],10)])}this.initChart(a,e)}$$("div.petapp div.wortlaut div.clicker").each(function(a){a.observe("click",this.openCloseWortlaut.bindAsEventListener(this))},this);var i=$$("div.petapp div.formular");i.length>0&&(new sessionChecker,i[0].setStyle({display:"block"}),this.petform=i[0].select("form")[0],this.petform.stopObserving("submit"),this.petform.observe("submit",this.submit.bindAsEventListener(this)),this.prefix=this.petform.readAttribute("data-prefix"),this.reloadUrl=null,this.petLoadingDark=$(this.prefix+"-loadingDark"),this.petLoadingLight=$(this.prefix+"-loadingLight"),this.petLoadingLight.on("click","button.closeButton",this.loadingHide.bindAsEventListener(this)),this.petLoadingLight.on("click","button.reloadButton",function(){null!==this.reloadUrl?location.href=this.reloadUrl:window.location.reload(!0)}.bindAsEventListener(this)),$(this.prefix+"-Telefonnummer")&&$(this.prefix+"-Telefonnummer").observe("keyup",this.checkPhone.bindAsEventListener(this)))},checkPhone:function(a){var b=a.target;b.value=b.value.replace(/^\+/,"00").replace(/[\/-]/," ").replace(/  /g," ").replace(/[^0-9 ]/gi,"")},submit:function(a){Event.stop(a),this.loadingShow();var b=!1;b=this.setRemoveError(this.prefix+"-Anrede",b,$F(this.prefix+"-Anrede").blank()),b=this.setRemoveError(this.prefix+"-Vorname",b,$F(this.prefix+"-Vorname").blank()),b=this.setRemoveError(this.prefix+"-Nachname",b,$F(this.prefix+"-Nachname").blank()),b=this.setRemoveError(this.prefix+"-Email",b,!validateEmail($F(this.prefix+"-Email"),!0)),b=this.setRemoveError(this.prefix+"-Strasse",b,$F(this.prefix+"-Strasse").blank()),b=this.setRemoveError(this.prefix+"-PLZ",b,$F(this.prefix+"-PLZ").blank()),b=this.setRemoveError(this.prefix+"-Ort",b,$F(this.prefix+"-Ort").blank()),b=this.setRemoveError(this.prefix+"-Land",b,$F(this.prefix+"-Land").blank()||"0"==$F(this.prefix+"-Land")),b?this.petLoadingLight.update("Es sind Fehler im Formular aufgetreten. Bitte überprüfen Sie Ihre Eingaben.<br><button class='closeButton' type='button'>OK</button>"):this.petform.request({method:"post",onComplete:this.submitDone.bind(this)})},submitDone:function(a){var b="Aus technischen Gründen kann ihre Anfrage nicht bearbeitet werden. Wir entschuldigen uns für etwaige Unanehmlichkeiten! Die Seite wird nun neu geladen. Ihre Daten gehen dadurch leider verloren.<br><button class='reloadButton' type='button'>OK</button>";if(a.responseText.isJSON()){var c=a.responseText.evalJSON(!0);if(c.formError)if(c.formError.undefined)this.petLoadingLight.update(b);else{for(var d in c.formError)c.formError.hasOwnProperty(d)&&this.setRemoveError(d,!1,!0);this.petLoadingLight.update("Leider ist im Formular ein Fehler aufgetreten. Bitte füllen Sie alle Felder korrekt aus.<br><button class='closeButton' type='button'>OK</button>")}else c.Error?this.petLoadingLight.update(c.Error+"<br><button class='reloadButton' type='button'>OK</button>"):c.done?($(this.prefix+"-thx").addClassName("visible"),$(this.prefix+"-moreoptions-newsletter").checked?$(this.prefix+"-thx").addClassName("nl"):$(this.prefix+"-thx").addClassName("nonl"),this.loadingHide(),"function"==typeof ga&&ga("send",{hitType:"event",eventCategory:c.eventCategory,eventAction:c.eventAction,eventLabel:c.eventLabel,eventValue:c.eventValue})):this.petLoadingLight.update(b)}else this.petLoadingLight.update(b)},setRemoveError:function(a,b,c){if($(a)){if(c)return $(a).writeAttribute("aria-invalid","true"),$(a).up("li").addClassName("fehler"),!0;$(a).writeAttribute("aria-invalid","false"),$(a).up("li").removeClassName("fehler")}return b},loadingShow:function(){this.petLoadingDark.setStyle({display:"block"}),this.petLoadingLight.update("Sende / Lade Daten...").setStyle({display:"block"})},loadingHide:function(){this.petLoadingDark.setStyle({display:"none"}),this.petLoadingLight.setStyle({display:"none"})},openCloseWortlaut:function(a){var b=a.target.up("div.wortlaut");b.hasClassName("open")?b.removeClassName("open"):b.addClassName("open")},initChart:function(a,b){var c=new google.visualization.DataTable;c.addColumn("string","A"),c.addColumn("number","B"),c.addRows(b);var d=new google.visualization.PieChart(a),e={backgroundColor:{fill:"transparent"},legend:"none",width:"100%",height:"100%",chartArea:{left:0,top:0,width:"100%",height:"100%"},colors:["#FFFF00","#000000"],enableInteractivity:!1,pieSliceText:"none",pieSliceBorderColor:"transparent"};d.draw(c,e)}}),slideshowController=Class.create({initialize:function(a){for(var b=$$(a),c=0,d=b.length;d>c;++c){var e=b[c].readAttribute("data-slideshow").split(":");new slideshowFade(b[c].childNodes,{startDelay:e[0],fadeDuration:e[1],nextDelay:e[2],ctrlPrev:b[c].previous(".control"),ctrlNext:b[c].next(".control")})}}}),slideshowFade=Class.create({initialize:function(a,b){if(this.options={startDelay:0,fadeDuration:1,nextDelay:3,ctrlPrev:void 0,ctrlNext:void 0},Object.extend(this.options,b||{}),this.slideshowImgs=a,this.slideshowImgs.length>1){this.removeActiveAttribute(),this.slideshowImgs[0].setStyle({opacity:1,display:"block"}).writeAttribute("aria-expanded","true");for(var c=1,d=this.slideshowImgs.length;d>c;++c)this.slideshowImgs[c].setStyle({opacity:0,display:"none"});this.currentSlideshowImage=0,this.options.ctrlPrev&&(this.options.ctrlPrev.observe("click",this.slideshowFade.bindAsEventListener(this,-1)).observe("keydown",this.slideshowFade.bindAsEventListener(this,-1)),this.options.ctrlNext.observe("click",this.slideshowFade.bindAsEventListener(this,1)).observe("keydown",this.slideshowFade.bindAsEventListener(this,1))),0==this.options.startDelay?this.pe=new PeriodicalExecuter(this.slideshowFade.bind(this),this.options.nextDelay):window.setTimeout(this.slideshowStart.bind(this),1e3*this.options.startDelay)}else this.options.ctrlPrev&&(this.options.ctrlPrev.remove(),this.options.ctrlNext.remove())},slideshowStart:function(){this.pe=new PeriodicalExecuter(this.slideshowFade.bind(this),this.options.nextDelay)},slideshowFade:function(a,b){if(void 0!=b&&this.pe&&(this.pe.stop(),this.pe=null,this.options.fadeDuration/=2),this.removeActiveAttribute(),void 0!=b&&0>b)0==this.currentSlideshowImage?(this.slideshowImgs[this.slideshowImgs.length-1].appear({duration:this.options.fadeDuration,afterFinish:function(){for(var a=1,b=this.slideshowImgs.length-1;b>a;++a)this.slideshowImgs[a].setStyle({opacity:1,display:"block"})}.bind(this)}),this.currentSlideshowImage=this.slideshowImgs.length-1):(this.slideshowImgs[this.currentSlideshowImage].fade({from:1,to:0,duration:this.options.fadeDuration}),--this.currentSlideshowImage);else if(++this.currentSlideshowImage,this.currentSlideshowImage>=this.slideshowImgs.length&&(this.currentSlideshowImage=0),0==this.currentSlideshowImage){for(var c=1,d=this.slideshowImgs.length-1;d>c;++c)this.slideshowImgs[c].setStyle({display:"none"});this.slideshowImgs[this.slideshowImgs.length-1].fade({from:1,to:0,duration:this.options.fadeDuration})}else this.slideshowImgs[this.currentSlideshowImage].appear({duration:this.options.fadeDuration});this.slideshowImgs[this.currentSlideshowImage].writeAttribute("aria-expanded","true")},removeActiveAttribute:function(){for(var a=0,b=this.slideshowImgs.length;b>a;++a)this.slideshowImgs[a].writeAttribute("aria-expanded","false")}}),suggestClass=Class.create({initialize:function(a,b){if(this.formTag=a,this.originalAction=this.formTag.readAttribute("action"),this.keyTimer=null,this.inputField=void 0,this.minWidth=200,this.initForm(),this.formTag.observe("submit",function(){this.formTag.writeAttribute("action",this.originalAction)}.bindAsEventListener(this)),this.inputField){this.inputSize=this.inputField.getDimensions(),this.inputPos=this.inputField.positionedOffset(),Event.observe(this.inputField,"keyup",this.checkKeys.bind(this)),Event.observe(this.inputField,"blur",this.closeSuggestBox.bind(this)),this.lastValue=!1,this.highlightedItem=null;var c=new Date;this.unique=c.getDate()+c.getTime()+b,this.suggestBox=!1,this.suggestList=!1}},initForm:function(){this.formTag.writeAttribute("action",systemVars.htmlRoot+systemVars.lang+"/view/ajax/suggest/get/");var a=this.formTag.readAttribute("data-suggest");a=this.formTag.select("input[name='"+a+"']"),a.length>0&&(this.inputField=a[0])},checkKeys:function(a){this.keyTimer&&window.clearTimeout(this.keyTimer),this.keyTimer=window.setTimeout(this.checkKeysDo.bind(this,a),400)},checkKeysDo:function(a){switch(this.keyTimer=null,a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:case Event.KEY_LEFT:case Event.KEY_RIGHT:case Event.KEY_HOME:case Event.KEY_PAGEUP:case Event.KEY_PAGEDOWN:case Event.KEY_END:return}if(a.keyCode==Event.KEY_UP)this.suggestBox&&this.highlightItemByKey(-1);else if(a.keyCode==Event.KEY_DOWN)this.suggestBox&&this.highlightItemByKey(1);else if(a.keyCode==Event.KEY_ESC)this.inputField.value==this.lastValue,this.closeSuggestBox();else{var b=$F(this.inputField).strip();b!=this.lastValue&&(this.lastValue=b),this.highlightedItem=null,this.lastValue.blank()?this.closeSuggestBox():this.get(this.lastValue)}},get:function(a){this.formTag.request({method:"post",onComplete:this.requestComplete.bind(this)})},requestComplete:function(a){if(a.responseText.isJSON()){var b=a.responseText.evalJSON(!0);b.length>0?this.buildSuggestBox(b):this.closeSuggestBox()}},buildSuggestBox:function(a){this.suggestBox?this.suggestList&&this.suggestList.remove():(this.suggestBox=Builder.node("div",{className:"suggestBoxDiv"},[Builder.node("div",{className:"suggestNotice"},"Andere User suchten:")]),$$("body")[0].appendChild(this.suggestBox)),this.suggestList=Builder.node("ul"),this.suggestBox.appendChild(this.suggestList);for(var b,c=0;b=a[c];++c){var d=Builder.node("li",{"data-suggest-term":b.term},[Builder.node("div",b.term),Builder.node("div",{className:"treffer"},b.count)]);this.suggestList.appendChild(d),d.observe("mouseover",this.highlightItemByMouse.bindAsEventListener(this)),d.observe("click",this.doSubmit.bindAsEventListener(this))}this.suggestBox.setStyle({width:"auto"}),this.suggestBox.getWidth()<this.inputSize.width&&this.suggestBox.setStyle({width:this.inputSize.width+"px"}),this.suggestBox.getWidth()<this.minWidth&&this.suggestBox.setStyle({width:this.minWidth+"px"}),this.suggestBox.clonePosition(this.inputField,{setWidth:!1,setHeight:!1,offsetTop:this.inputSize.height})},highlightItemByKey:function(a){var b=this.suggestList.select("li");null===this.highlightedItem&&(a>0?this.highlightedItem=-1:this.highlightedItem=b.length),$(b[this.highlightedItem+a])&&($(b[this.highlightedItem])&&$(b[this.highlightedItem]).removeClassName("suggestHighlight"),this.highlightedItem=this.highlightedItem+a,$(b[this.highlightedItem]).addClassName("suggestHighlight"),this.inputField.value=$(b[this.highlightedItem]).readAttribute("data-suggest-term"))},highlightItemByMouse:function(a){if("li"==a.target.tagName.toLowerCase())var b=a.target;else var b=a.element().up("li");for(var c,d=this.suggestList.select("li"),e=0;c=d[e];++e)b==$(c)?(b.addClassName("suggestHighlight"),this.highlightedItem=e):$(c).hasClassName("suggestHighlight")&&$(c).removeClassName("suggestHighlight")},doSubmit:function(a){var b=a.element().up("li").readAttribute("data-suggest-term");this.lastValue=b,this.inputField.value=this.lastValue,this.formTag.writeAttribute("action",this.originalAction),this.formTag.submit()},closeSuggestBox:function(){window.setTimeout(this.doCloseSuggestBox.bind(this),500)},doCloseSuggestBox:function(){this.suggestBox&&(this.suggestBox.remove(),this.suggestBox=!1)}}),tagsClass=Class.create(suggestClass,{initialize:function($super,a,b){$super(a,b),void 0!=this.inputField&&(a.up("li").setStyle({display:"inline-block"}),this.tagsChosenBox=!1,this.tagsChosenList=!1,this.defaultMinWidth=100,this.maxTags=3,this.currentTagCount=0,this.formTag.stopObserving("submit"),this.formTag.observe("submit",this.addTag.bindAsEventListener(this)))},initForm:function(){this.formTag.writeAttribute("action",systemVars.htmlRoot+systemVars.lang+"/view/ajax/suggest/tags/");var a=this.formTag.readAttribute("data-tags");a=this.formTag.select("input[name='"+a+"']"),a.length>0&&(this.inputField=a[0])},buildSuggestBox:function(a){this.suggestBox?this.suggestList&&this.suggestList.remove():(this.suggestBox=Builder.node("div",{className:"tags-list"}),this.formTag.appendChild(this.suggestBox)),this.suggestList=Builder.node("ul"),this.suggestBox.appendChild(this.suggestList);for(var b,c=0;b=a[c];++c){var d=Builder.node("li",{"data-suggest-id":b.id,"data-suggest-term":b.term},b.term);this.suggestList.appendChild(d),d.observe("mouseover",this.highlightItemByMouse.bindAsEventListener(this)),d.observe("click",this.addTag.bindAsEventListener(this))}this.suggestBox.setStyle({width:"auto"}),this.inputSize=this.inputField.getDimensions(),this.suggestBox.getWidth()<this.inputSize.width?this.suggestBox.setStyle({width:this.inputSize.width+"px"}).clonePosition(this.inputField,{setWidth:!1,setHeight:!1,offsetTop:this.inputSize.height}):(this.suggestBox.clonePosition(this.inputField,{setWidth:!1,setHeight:!1,offsetTop:this.inputSize.height}),document.viewport.getDimensions().width<this.suggestBox.positionedOffset().left+this.suggestBox.getDimensions().width&&this.suggestBox.clonePosition(this.inputField,{setWidth:!1,setHeight:!1,offsetTop:this.inputSize.height,offsetLeft:-this.suggestBox.getDimensions().width+this.inputSize.width}))},doSubmit:function(){if(this.currentTagCount>0){for(var a,b=this.tagsChosenList.select("li"),c=[],d=0;a=b[d];++d)c.push("tags[]="+a.readAttribute("data-tagid"));location.href=this.originalAction+"&"+c.join("&")}},addTag:function(a){if("form"==a.target.tagName.toLowerCase())if(Event.stop(a),this.suggestBox){var b=this.suggestList.select("li.suggestHighlight");if(b.length>0)var b=b[0];else this.doSubmit()}else this.doSubmit();else var b=a.target;this.tagsChosenBox||(this.tagsChosenBox=Builder.node("div",{className:"tags-chosen"}),this.formTag.appendChild(this.tagsChosenBox),this.tagsChosenList=Builder.node("ul"),this.tagsChosenBox.appendChild(this.tagsChosenList));var c=Builder.node("li",{"data-tagid":b.readAttribute("data-suggest-id")},b.readAttribute("data-suggest-term"));c.observe("click",this.removeTag.bindAsEventListener(this)),this.tagsChosenList.appendChild(c),this.doCloseSuggestBox(),this.inputField.value="",this.inputField.focus();var d=this.tagsChosenBox.getDimensions().width;if(this.inputField.setStyle({paddingLeft:d+"px",minWidth:d+this.defaultMinWidth+"px"}),++this.currentTagCount,this.currentTagCount>=this.maxTags){this.formTag.select("button")[0].focus(),this.inputField.disabled=!0;var d=this.tagsChosenBox.getDimensions().width;this.inputField.setStyle({paddingLeft:d+"px",minWidth:d+"px"})}},removeTag:function(a){if(a.target.remove(),--this.currentTagCount,this.inputField.disabled=!1,this.tagsChosenList.select("li").length<1){this.tagsChosenBox.remove(),this.tagsChosenBox=!1;var b=0}else var b=this.tagsChosenBox.getDimensions().width;this.inputField.focus(),this.inputField.setStyle({paddingLeft:b+"px",minWidth:b+this.defaultMinWidth+"px"})}}),sessionSingleton=!1,sessionChecker=Class.create({initialize:function(){sessionSingleton||(sessionSingleton=!0,this.pe=new PeriodicalExecuter(this.check.bind(this),6),this.check())},check:function(){new Ajax.Request(systemVars.htmlRoot+systemVars.lang+"/view/ajax/suggest/reconnect/",{onSuccess:this.checkDone.bind(this)})},checkDone:function(a){if(this.pe.stop(),this.pe=null,a.responseText.isJSON()){var b=a.responseText.evalJSON(!0);if(b.allowed)return}this.showAlert()},showAlert:function(){var a=$$("div.sessionAlertPosition");if(a.length<1){var b=["Herzlichen Dank für Ihr Engagement und Interesse an unser Arbeit!","Sie können unsere komplette Homepage selbstverständliche OHNE Cookies benutzen.","","Wenn Sie mit uns kommunizieren möchten, also <em>z.B. uns mit einer Unterschrift oder Spende unterstützen wollen</em>,","muss, aus technischen Gründen ein sogenanntes &quot;<a href='http://de.wikipedia.org/wiki/Sitzungsbezeichner' target='_blank'>Session Cookie</a>&quot; gesetzt werden.","Ihre aktuellen Browsereinstellungen verhindern dies, somit ist leider <em>kein Absenden der Daten an uns</em> möglich."];alertNode=Builder.node("div",{className:"sessionAlertPosition"},[Builder.node("div",{className:"sessionAlert"},[Builder.node("div",{className:"alertText",role:"alert"}).update(b.join("<br>\n"))])]),$("topOfPage").insert({after:alertNode}),window.setTimeout(function(){alertNode.addClassName("appear")},600)}}});document.observe("dom:loaded",function(){new petitionApp,new slideshowController("*[data-slideshow]");for(var a,b=$$("form[data-suggest]"),c=0;a=b[c];++c)new suggestClass(a,c);for(var a,b=$$("form[data-tags]"),c=0;a=b[c];++c)new tagsClass(a,c)});