var accordion=Class.create({initialize:function(a,b,c){if(this.version=20140818,"string"==typeof a&&$(a)?this.toggles=[$(a)]:"string"==typeof a?this.toggles=$$(a):this.toggles=a,"string"==typeof b&&$(b)?this.stretchers=[$(b)]:"string"==typeof b?this.stretchers=$$(b):this.stretchers=b,this.stati=[],this.toggles.length!=this.stretchers.length){for(var d=0,e=this.toggles.length;e>d;++d)this.toggles[d].setStyle({border:"solid 1px #f00"});for(var d=0,e=this.stretchers.length;e>d;++d)this.stretchers[d].setStyle({border:"solid 1px #00f"});alert("accordion.js: Accordion needs the same amount of toggles ("+this.toggles.length+", red) and stretchers ("+this.stretchers.length+", blue)!")}else{if(this.options={animate:!0,startAllOpened:!1,startOpened:null,openByHash:null,doScroll:!1,depends:!0,canClose:!0,duration:.6,minHeightClosed:0,minHeightOpened:!1,maxHeightOpened:!1,upperElement:null,openedCssClass:null,elementWithCss:null,onBeforeOpen:null,onAfterOpen:null,onBeforeClose:null,onAfterClose:null,onAfterCheckSize:null,overflow:"hidden"},Object.extend(this.options,c||{}),!this.options.depends&&this.options.canClose&&this.options.startAllOpened);else{var f=null;if(null!=this.options.startOpened&&String(this.options.startOpened).match(/^#/)){this.options.startOpened=this.options.startOpened.replace(/^#/,"");for(var g=this.options.startOpened,d=0,e=this.toggles.length;e>d;++d){if(this.toggles[d].id&&g==this.toggles[d].id){this.options.startOpened=d,f=this.toggles[d].id;break}if(this.stretchers[d].id&&"open"+g==this.stretchers[d].id){this.options.startOpened=d,f=this.stretchers[d].id;break}if(this.toggles[d].select("#"+g).length>0){this.options.startOpened=d,f=this.toggles[d].select("#"+g)[0];break}if(this.stretchers[d].select("#"+g).length>0){this.options.startOpened=d,f=this.stretchers[d].select("#"+g)[0];break}if(this.toggles[d].up("#"+g)){this.options.startOpened=d,f=this.toggles[d].up("#"+g);break}if(this.stretchers[d].up("#"+g)){this.options.startOpened=d,f=this.stretchers[d].up("#"+g);break}}}else null!=this.options.startOpened&&isNaN(parseInt(this.options.startOpened,10))&&(this.options.startOpened=null);if(null!=this.options.openByHash&&String(window.location.hash).match(this.options.openByHash))for(var g=String(window.location.hash).replace(/^#/,""),d=0,e=this.toggles.length;e>d;++d){if(this.toggles[d].id&&g==this.toggles[d].id){this.options.startOpened=d,f=this.toggles[d].id;break}if(this.stretchers[d].id&&"open"+g==this.stretchers[d].id){this.options.startOpened=d,f=this.stretchers[d].id;break}if(this.toggles[d].select("#"+g).length>0){this.options.startOpened=d,f=this.toggles[d].select("#"+g)[0];break}if(this.stretchers[d].select("#"+g).length>0){this.options.startOpened=d,f=this.stretchers[d].select("#"+g)[0];break}if(this.toggles[d].up("#"+g)){this.options.startOpened=d,f=this.toggles[d].up("#"+g);break}if(this.stretchers[d].up("#"+g)){this.options.startOpened=d,f=this.stretchers[d].up("#"+g);break}}null!=this.options.startOpened&&this.options.doScroll&&null!=f&&(Prototype.Browser.IE?window.setTimeout(function(){Effect.ScrollTo(f)},1e3):Event.observe(window,"load",function(){Effect.ScrollTo(f)}))}null==this.options.elementWithCss||this.options.elementWithCss.length&&this.options.elementWithCss.length==this.toggles.length||(this.options.elementWithCss=null);for(var d=0,e=this.toggles.length;e>d;++d){if(this.toggles[d]=$(this.toggles[d]),this.stretchers[d]=$(this.stretchers[d]),!this.toggles[d]||!this.stretchers[d]){alert("accordion.js: Some DOM-elements doesn't exist!");break}if(this.options.startAllOpened||null!=this.options.startOpened&&d==this.options.startOpened){if(null!=this.options.openedCssClass&&(this.toggles[d].addClassName(this.options.openedCssClass),this.stretchers[d].addClassName(this.options.openedCssClass),null!=this.options.elementWithCss&&this.options.elementWithCss[d].addClassName(this.options.openedCssClass),null!=this.options.onBeforeOpen&&"function"==typeof this.options.onBeforeOpen)){var h=void 0;null!=this.options.elementWithCss&&(h=this.options.elementWithCss[d]);var i=this.options.onBeforeOpen(d,this.toggles[d],this.stretchers[d],h);null!=this.options.onAfterOpen&&"function"==typeof this.options.onAfterOpen&&window.setTimeout(this.options.onAfterOpen.bind(this,d,this.toggles[d],this.stretchers[d],h),i)}var j=this.calcHeight(this.stretchers[d]);this.stretchers[d].setStyle({overflow:j.overflow,height:j.height+"px"}),this.stati[d]={open:!0,height:j.height,pe:!1},this.toggles[d].writeAttribute({"aria-expanded":"true","aria-selected":"true"}),this.stretchers[d].writeAttribute({"aria-hidden":"false"})}else this.stretchers[d].setStyle({overflow:this.options.overflow,height:this.options.minHeightClosed+"px"}),this.stati[d]={open:!1,height:this.options.minHeightClosed,pe:!1},this.toggles[d].writeAttribute({"aria-expanded":"false","aria-selected":"false"}),this.stretchers[d].writeAttribute({"aria-hidden":"true"});if(this.toggles[d].writeAttribute({tabindex:"0",role:"tab","aria-controls":this.stretchers[d].identify()}),this.stretchers[d].writeAttribute({"aria-labelledby":this.toggles[d].identify(),role:"tabpanel"}),this.toggles[d].setStyle({cursor:"pointer"}).observe("click",this.openClose.bindAsEventListener(this,d)).observe("keydown",this.keyToggles.bindAsEventListener(this,d)),this.stretchers[d].on("keyup","*",this.keyStretcher.bindAsEventListener(this,d)),this.options.upperElement){var k=this.toggles[d].up(this.options.upperElement);k&&k.writeAttribute({role:"tablist",multiselectable:this.options.depends?"false":"true"})}}}},keyStretcher:function(a,b){9!=a.keyCode||this.stati[b].open?a.ctrlKey&&38==a.keyCode&&(this.toggles[b].focus(),Event.stop(a)):this.openClose(void 0,b)},keyToggles:function(a,b){if(a&&a.findElement("a")&&"a"==a.findElement("a").nodeName.toLowerCase()){if(a.findElement("a")!=this.toggles[b])return;Event.stop(a)}13==a.keyCode||32==a.keyCode?this.openClose(void 0,b):35==a.keyCode?(this.toggles[this.toggles.length-1].focus(),Event.stop(a)):36==a.keyCode?(this.toggles[0].focus(),Event.stop(a)):37==a.keyCode||38==a.keyCode?(b>0&&b--,this.toggles[b].focus(),Event.stop(a)):(39==a.keyCode||40==a.keyCode)&&(b<=this.toggles.length-1&&++b,this.toggles[b].focus(),Event.stop(a))},openClose:function(a,b,c){if(a&&a.findElement("a")&&"a"==a.findElement("a").nodeName.toLowerCase()){if(a.findElement("a")!=this.toggles[b])return;Event.stop(a)}if(c===!0){if(this.options.depends&&!this.stati[b].open)for(var d=0,e=this.stretchers.length;e>d;++d)d!=b&&this.stati[d].open&&this.prepareOpenClose(d,!1);this.stati[b].open?this.checkSize():this.prepareOpenClose(b,!0)}else if(c===!1)this.stati[b].open&&this.options.canClose&&this.prepareOpenClose(b,!1);else{if(this.options.depends&&!this.stati[b].open)for(var d=0,e=this.stretchers.length;e>d;++d)d!=b&&this.stati[d].open&&this.prepareOpenClose(d,!1);this.stati[b].open?this.options.canClose&&this.prepareOpenClose(b,!1):this.prepareOpenClose(b,!0)}},prepareOpenClose:function(a,b){var c=b?this.options.onBeforeOpen:this.options.onBeforeClose;if(null!=c&&"function"==typeof c){var d=void 0;null!=this.options.elementWithCss&&(d=this.options.elementWithCss[a]);var e=c(a,this.toggles[a],this.stretchers[a],d);e&&e>0?window.setTimeout(this.doOpenClose.bind(this,a,b),e):this.doOpenClose(a,b)}else this.doOpenClose(a,b)},doOpenClose:function(a,b){if(b){this.stati[a].pe&&this.stati[a].pe.cancel();var c=this.calcHeight(this.stretchers[a]);this.stati[a].open=!0,this.options.animate?this.stati[a].pe=new Effect.Tween(null,this.stati[a].height,c.height,{duration:this.options.duration,transition:Effect.Transitions.sinoidal,afterFinish:this.hasStopped.bindAsEventListener(this,a,b)},this.update.bindAsEventListener(this,a)):this.stretchers[a].setStyle({height:"auto"}),this.toggles[a].writeAttribute({"aria-expanded":"true","aria-selected":"true"}),this.stretchers[a].writeAttribute({"aria-hidden":"false"}),null!=this.options.openedCssClass&&(this.toggles[a].addClassName(this.options.openedCssClass),this.stretchers[a].addClassName(this.options.openedCssClass),null!=this.options.elementWithCss&&this.options.elementWithCss[a].addClassName(this.options.openedCssClass))}else this.stati[a].pe&&this.stati[a].pe.cancel(),this.stati[a].open=!1,this.options.animate?this.stati[a].pe=new Effect.Tween(null,this.stati[a].height,this.options.minHeightClosed,{duration:this.options.duration,transition:Effect.Transitions.sinoidal,afterFinish:this.hasStopped.bindAsEventListener(this,a,b)},this.update.bindAsEventListener(this,a)):this.stretchers[a].setStyle({height:this.options.minHeightClosed+"px"}),this.toggles[a].writeAttribute({"aria-expanded":"false","aria-selected":"false"}),this.stretchers[a].writeAttribute({"aria-hidden":"true"}),null!=this.options.openedCssClass&&(this.toggles[a].removeClassName(this.options.openedCssClass),this.stretchers[a].removeClassName(this.options.openedCssClass),null!=this.options.elementWithCss&&this.options.elementWithCss[a].removeClassName(this.options.openedCssClass))},update:function(a,b){void 0==a&&(a=this.options.minHeightClosed),this.stati[b].height=a,this.stretchers[b].setStyle({height:a+"px"})},hasStopped:function(a,b,c){if(c===!0&&null!=this.options.onAfterOpen&&"function"==typeof this.options.onAfterOpen){var d=void 0;null!=this.options.elementWithCss&&(d=this.options.elementWithCss[b]),this.options.onAfterOpen(b,this.toggles[b],this.stretchers[b],d)}else if(c===!1&&null!=this.options.onAfterClose&&"function"==typeof this.options.onAfterClose){var d=void 0;null!=this.options.elementWithCss&&(d=this.options.elementWithCss[b]),this.options.onAfterClose(b,this.toggles[b],this.stretchers[b],d)}else if(void 0===c&&null!=this.options.onAfterCheckSize&&"function"==typeof this.options.onAfterCheckSize){var d=void 0;null!=this.options.elementWithCss&&(d=this.options.elementWithCss[b]),this.options.onAfterCheckSize(b,this.toggles[b],this.stretchers[b],d)}this.stati[b].pe=!1},checkSize:function(){for(var a=0,b=this.stretchers.length;b>a;++a)if(this.stati[a].open){this.stati[a].pe&&this.stati[a].pe.cancel();var c=this.calcHeight(this.stretchers[a],!0);this.stretchers[a].setStyle({overflow:c.overflow}),this.options.animate?this.stati[a].height!=c.height&&(this.stati[a].open=!0,this.stati[a].pe=new Effect.Tween(null,this.stati[a].height,c.height,{duration:this.options.duration,transition:Effect.Transitions.sinoidal,afterFinish:this.hasStopped.bindAsEventListener(this,a)},this.update.bindAsEventListener(this,a))):this.stretchers[a].setStyle({height:"auto"});break}},getInnerHeight:function(a){for(var b=0,c=0,d=a.childNodes.length;d>c;++c){var e=0,f=0,g=0;a.childNodes[c].getStyle&&(e=parseInt(a.childNodes[c].getStyle("marginTop"),10),g=parseInt(a.childNodes[c].getStyle("marginBottom"),10)),a.childNodes[c].offsetHeight&&(f=a.childNodes[c].offsetHeight),b+=f+e+g}return b<this.options.minHeightClosed&&(b=this.options.minHeightClosed),b},calcHeight:function(a,b){if(b)var c=this.getInnerHeight(a);else var c=a.scrollHeight;return this.options.maxHeightOpened&&c>this.options.maxHeightOpened?{height:this.options.maxHeightOpened,overflow:this.options.overflow}:this.options.minHeightOpened&&c<this.options.minHeightOpened?{height:this.options.minHeightOpened,overflow:this.options.overflow}:{height:c,overflow:this.options.overflow}},rescan:function(a,b){for(var c=0,d=this.stretchers.length;d>c;++c)this.stretchers[c].setStyle({height:"auto"}),this.toggles[c].setStyle({cursor:"default"}).stopObserving("click");this.initialize(a,b,this.options)}});